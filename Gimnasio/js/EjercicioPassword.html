<!DOCTYPE html>
<html>
    <head lang="es">
        <meta charset="UTF-8">
        <title>Password</title>
    </head>
    <body>

        <form name="login">
            <label>Usuario</label>
            <input type="text" value="" name="user"></input></br>
            <label>Contraseña</label>
            <input type="text" value="" name="password"></input>
        </form>
        <button onclick="checkPassword();" >Aceptar</button>
        <div id="resultAcceso"></div>

        <script>
            
            // Funcion enlazado al button de HTML
            function checkPassword(){

                // Valores del formulario
                var user = login.user.value;
                var password = login.password.value;
                
                // Div en el que mostrare el mensaje de la validación
                var divResultado = document.getElementById('resultAcceso');

                // Esta comprobacion llama a cada una de las funciones de validación y si una no se cumple pasara por el else
                if( userNoVacio(user) && mayorDeOcho(password) && unaLetraMayuscula(password) && unaLetraMinuscula(password) && tieneUnNumero(password) && tieneCaracterEspecial(password) ){
                    // Testo del resultado Correcto y color de fondo verde
                    divResultado.style.backgroundColor = 'green';
                    divResultado.textContent = 'Correcto';
                } else {
                    // Testo del resultado Error y color de fondo rojo
                    divResultado.style.backgroundColor = 'red';
                    divResultado.textContent = 'Error';
                }
            }
            
            // Funcion que comprueba mediante una expresión regular que haya al menos 8 carácteres
            function mayorDeOcho( password ){

                var patron=/.{8}/g;
                var result = patron.test(password); 
                if( result ){
                    return result;
                } else {
                    alert("La contraseña debe tener al menos 8 carácteres");
                    return result;
                }

            }

            function unaLetraMayuscula( password ){
                
                var patron=/[A-Z]{1}/;
                var result = patron.test(password); 
                if( result ){
                    return result;
                } else {
                    alert("La contraseña debe tener al menos una mayuscula");
                    return result;
                }

            }
            
            function unaLetraMinuscula( password ){
                
                var patron=/[a-z]{1}/;
                var result = patron.test(password); 
                if( result ){
                    return result;
                } else {
                    alert("La contraseña debe tener al menos una minuscula");
                    return result;
                }

            }

            function tieneUnNumero( password ){
                
                var patron=/\d{1}/;
                var result = patron.test(password); 
                if( result ){
                    return result;
                } else {
                    alert("La contraseña debe tener al menos un numero");
                    return result;
                }

            }

            function tieneCaracterEspecial( password ){
                
                var charEspeciales = "_-@#$%&";
                var i = 0;

                for( i = 0; i < password.length; i++ ){
                    if( charEspeciales.indexOf(password.charAt(i)) != -1 ){
                        return true;
                    }
                }

                alert("La contraseña debe tener al menos un caracter especial: "+ charEspeciales);
                return false;

            }

            function userNoVacio( user ){
                if( user != "" ){
                    return true;
                } else {
                    alert("Debes introducir un nombre de usuario");
                    return false;
                }

            }

        </script>
    </body>
</html>